<nav class="navbar navbar-static-top navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand visible-xs visible-sm" href="/">Binaergewitter</a>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="{{ "pages/abonnieren/" | relURL }}">Abonnieren</a>
                </li>
                <li>
                    <a href="{{ "pages/impressum/" | relURL }}">Impressum und Datenschutz</a>
                </li>
                <li>
                    <a href="{{ "pages/live/" | relURL }}" id="live-link">Live</a>
                </li>
                <li>
                    <a href="{{ "pages/spenden/" | relURL }}">Spenden</a>
                </li>
                <li>
                    <a href="{{ "pages/ueber-uns/" | relURL }}">Ãœber uns</a>
                </li>
                <li>
                    <a href="{{ "archives" | relURL }}">Archives</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
    // Client-side is_live check
    async function checkLive() {
        try {
            // Proxy through our nginx to avoid mixed content issues (HTTP from HTTPS)
            const response = await fetch('/api/stream-status');
            const data = await response.json();

            // Check if there's a source field and if it contains binaergewitter.mp3
            const sources = data.icestats?.source;
            let isLive = false;

            if (sources) {
                isLive = Array.isArray(sources)
                    ? sources.some(s => s.listenurl?.includes('binaergewitter.mp3'))
                    : sources.listenurl?.includes('binaergewitter.mp3');
            }

            const liveLink = document.getElementById('live-link');
            if (liveLink) {
                if (isLive) {
                    liveLink.innerHTML = 'ðŸ”´ Live (On Air)';
                    liveLink.style.fontWeight = 'bold';
                } else {
                    liveLink.innerHTML = 'Live';
                    liveLink.style.fontWeight = 'normal';
                }
            }
        } catch (e) {
            // Silently fail - likely CORS or network issue
            console.debug('Could not check live status:', e.message);
        }
    }

    // Check on page load
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', checkLive);
    } else {
        checkLive();
    }

    // Check every 60 seconds
    setInterval(checkLive, 60000);
</script>